{% extends 'company/layouts/base.html' %}
{% load static %}
{% block extra_css %}
<!-- Choices.js CSS (load first) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">

<!-- Base styles (load next) -->
<link rel="stylesheet" href="{% static 'companyadmin/css/company_registration.css' %}">
<link rel="stylesheet" href="{% static 'utils/css/choices.css' %}">
<link rel="stylesheet" href="{% static 'utils/css/modals.css' %}">

<!-- Component-specific styles (load last) -->
<link rel="stylesheet" href="{% static 'company/css/ad_profiles.css' %}">
<link rel="stylesheet" href="{% static 'company/css/confirm_dialogue.css' %}">
{% endblock %}
{% block title %}Ad Profiles{% endblock %}

{% block content %}
<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="text-golden">Food Flash Advertisement Profiles</h1>
      </div>
    </div>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="card shadow-sm border-0">
      <!-- Admin Outlet Info Section -->
      <div id="outlet-info" class="card-header">
        <!-- Admin Outlet Data will be injected here -->
      </div>
      
      <!-- Vendors List -->
      <div class="card-body">
        <p class="mb-2">You can view and create Advertisement Profiles from here.</p>
        <ul class="nav nav-tabs" id="profileTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active text-golden" id="create-tab" data-bs-toggle="tab" href="#create-profile" role="tab">Create Ad Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-golden" id="view-tab" data-bs-toggle="tab" href="#view-profiles" role="tab">View Ad Profiles</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-golden" id="assign-tab" data-bs-toggle="tab" href="#assign-profile" role="tab">Assign Ad Profile</a>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content pt-3" id="profileTabContent">
          <!-- View Profiles Tab -->
          <div class="tab-pane fade" id="view-profiles" role="tabpanel">
            <div class="table-responsive">
              <table class="table table-hover table-bordered rounded shadow-sm bg-light-gray">
                <thead class="thead-light">
                  <tr>
                    <th>Name</th>
                    <th>Date Range</th>
                    <th>Days Active</th>
                    <th>Priority</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ad-profile-table-body">
                  <!-- JS Injected Rows -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Create Profile Tab -->
          <div class="tab-pane fade show active" id="create-profile" role="tabpanel">
            <form id="create-profile-form" class="bg-white p-4 rounded shadow-sm border border-light">
              <div class="mb-4">
                <h5 class="text-golden mb-3">Basic Details</h5>
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="profile-name">Profile Name</label>
                    <input type="text" class="form-control" id="profile-name" required placeholder="Enter advertisement profile name">
                  </div>

                  <!-- Priority Column -->
                  <div class="form-group col-md-4">
                    <label for="priority">
                      Ad Display Priority
                      <i class="fas fa-info-circle text-secondary ml-1"
                        data-toggle="tooltip"
                        data-placement="right"
                        title="Select how important this ad is. 'Top Priority' ads appear
                         first and are shown during key times like holidays or big offers.
                          'Backup Priority' ads appear only if no other ads are scheduled."></i>
                    </label>
                    {% comment %} <label for="priority">Ad Display Priority</label> {% endcomment %}
                    <select id="priority" class="form-control">
                      <option value="1">Top Priority - Holiday Focus</option>
                      <option value="2">High Priority - Weekend Promo</option>
                      <option value="3">Standard Priority - Weekday Offer</option>
                      <option value="4">Low Priority - Off-Peak Display</option>
                      <option value="5">Backup Priority - Fallback Slot</option>
                    </select>
                  </div>

                </div>
              </div>

              <div class="mb-4">
                <h5 class="text-golden mb-3">Schedule & Priority</h5>
                <div class="form-row">
                  <!-- Days Active Column -->
                  <div class="form-group col-md-12">
                    <label class="d-flex justify-content-between align-items-center">
                      Days Active
                      <div class="custom-control custom-checkbox mr-3 mb-2">
                        <input type="checkbox" class="custom-control-input" id="select-all-days">
                        <label class="custom-control-label text-muted small" for="select-all-days">Select All</label>
                      </div>
                    </label>

                    <div id="days-checkboxes" class="row ml-1">
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Monday" value="Monday">
                          <label class="custom-control-label" for="day-Monday">Monday</label>
                        </div>
                      </div>
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Tuesday" value="Tuesday">
                          <label class="custom-control-label" for="day-Tuesday">Tuesday</label>
                        </div>
                      </div>
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Wednesday" value="Wednesday">
                          <label class="custom-control-label" for="day-Wednesday">Wednesday</label>
                        </div>
                      </div>
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Thursday" value="Thursday">
                          <label class="custom-control-label" for="day-Thursday">Thursday</label>
                        </div>
                      </div>
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Friday" value="Friday">
                          <label class="custom-control-label" for="day-Friday">Friday</label>
                        </div>
                      </div>
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Saturday" value="Saturday">
                          <label class="custom-control-label" for="day-Saturday">Saturday</label>
                        </div>
                      </div>
                      <div class="col-6 col-sm-4 col-md-3 mb-2">
                        <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input day-checkbox" id="day-Sunday" value="Sunday">
                          <label class="custom-control-label" for="day-Sunday">Sunday</label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-group col-md-3">
                    <label for="date-start">Start Date</label>
                    <input type="date" class="form-control" id="date-start">
                  </div>

                  <div class="form-group col-md-3">
                    <label for="date-end">End Date</label>
                    <input type="date" class="form-control" id="date-end">
                  </div>
                </div>
              </div>
              
              <!-- Trigger Button -->
              <div class="mb-4">
                <label class="text-golden d-block mb-2">Advertisement Images</label>
                <button type="button" class="btn btn-outline-golden" id="open-image-library-btn">
                  <i class="fas fa-folder-open mr-1"></i> Select Images
                </button>

                <!-- Image Thumbnails -->
                <div id="selected-images-preview" class="d-flex flex-wrap mt-3"></div>
              </div>

              <!-- Hidden field for selected image IDs -->
              <input type="hidden" id="selected-image-ids" name="image_ids">
              <div class="text-center">
                <button type="submit" class="btn btn-golden mt-1">Create Ad Profile</button>
              </div>
            </form>
          </div>

          <!-- Assign Profile Tab -->
          <div class="tab-pane fade" id="assign-profile" role="tabpanel">
            <div class="container-fluid">
              <form id="assign-profile-form" method="POST" class="card px-4 py-3 mx-auto shadow-sm" style="max-width: 900px;">
                {% csrf_token %}
                <h4 class="text-center mb-4">Assign Advertisement Profiles to Outlets</h4>

                <div class="row">
                  <!-- Outlets -->
                  <div class="form-group col-md-6 col-12">
                    <label for="outlet-select">Outlets</label>
                    <div class="choices-scroll-wrapper">
                      <select id="outlet-select" name="outlets[]" multiple>
                        <!-- JS will dynamically populate options -->
                      </select>
                    </div>
                  </div>
                  <!-- Advertisement Profiles -->
                  <div class="form-group col-md-6 col-12">
                    <label for="ad-profile-select">Advertisement Profiles</label>
                    <div class="choices-scroll-wrapper">
                      <select id="ad-profile-select" name="profiles[]" multiple>
                        <!-- JS will dynamically populate options -->
                      </select>
                    </div>
                  </div>
                </div>
                <!-- Submit Button -->
                <div class="text-center mt-4">
                  <button type="submit" class="btn btn-golden px-4 py-2 shadow-sm">
                    <i class="fas fa-link mr-2"></i> Assign Profiles
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% include "company/partials/modals.html" %}
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script type="module" src="{% static 'company/js/adProfiles.js' %}"></script>
{% endblock %}
